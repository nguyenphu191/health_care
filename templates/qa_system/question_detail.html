{% extends 'base.html' %}

{% block title %}{{ question.title }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'qa_list' %}">Hỏi đáp</a></li>
                <li class="breadcrumb-item active">{{ question.title|truncatewords:5 }}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <!-- Question Card -->
        <div class="card mb-4">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">{{ question.title }}</h3>
                    <div>
                        {% if question.category %}
                            <span class="badge bg-secondary">{{ question.category }}</span>
                        {% endif %}
                        {% if question.is_anonymous %}
                            <span class="badge bg-warning">Ẩn danh</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="question-content">
                    {{ question.content|linebreaks }}
                </div>
                
                <hr>
                
                <div class="question-meta">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-user"></i>
                                <strong>Người hỏi:</strong>
                                {% if question.is_anonymous %}
                                    Ẩn danh
                                {% else %}
                                    {{ question.patient.user.get_full_name }}
                                {% endif %}
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <small class="text-muted">
                                <i class="fas fa-clock"></i>
                                <strong>Thời gian:</strong>
                                {{ question.created_at|date:"d/m/Y H:i" }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Answers Section -->
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">
                        <i class="fas fa-reply"></i> 
                        Câu trả lời ({{ answers.count }})
                    </h4>
                    {% if user.user_type == 'doctor' %}
                        <a href="{% url 'answer_question' question.id %}" class="btn btn-success">
                            <i class="fas fa-plus"></i> Thêm câu trả lời
                        </a>
                    {% endif %}
                </div>
            </div>
            <div class="card-body">
                {% if answers %}
                    {% for answer in answers %}
                    <div class="answer-item mb-4">
                        <div class="border-start border-4 border-primary ps-3">
                            <div class="answer-content">
                                {{ answer.content|linebreaks }}
                            </div>
                            
                            <div class="answer-meta mt-3">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <div class="d-flex align-items-center">
                                            <img src="https://via.placeholder.com/40/007bff/ffffff?text=Dr" 
                                                 class="rounded-circle me-2" alt="Doctor">
                                            <div>
                                                <strong class="text-primary">{{ answer.doctor }}</strong>
                                                <br>
                                                <small class="text-muted">
                                                    {% for spec in answer.doctor.specializations.all %}
                                                        {{ spec.name }}{% if not forloop.last %}, {% endif %}
                                                    {% endfor %}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-end">
                                        <small class="text-muted">
                                            <i class="fas fa-clock"></i>
                                            {{ answer.created_at|date:"d/m/Y H:i" }}
                                        </small>
                                        <br>
                                        {% if answer.is_helpful %}
                                            <span class="badge bg-success">
                                                <i class="fas fa-thumbs-up"></i> Hữu ích
                                            </span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {% if not forloop.last %}
                            <hr class="my-4">
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Chưa có câu trả lời nào</h5>
                        <p class="text-muted">Hãy chờ bác sĩ trả lời hoặc thử đặt câu hỏi khác.</p>
                        {% if user.user_type == 'doctor' %}
                            <a href="{% url 'answer_question' question.id %}" class="btn btn-primary">
                                <i class="fas fa-reply"></i> Trả lời câu hỏi này
                            </a>
                        {% elif user.user_type == 'patient' %}
                            <a href="{% url 'ask_question' %}" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Đặt câu hỏi mới
                            </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 text-center">
        <a href="{% url 'qa_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Quay lại danh sách hỏi đáp
        </a>
        {% if user.user_type == 'patient' %}
            <a href="{% url 'ask_question' %}" class="btn btn-primary">
                <i class="fas fa-plus"></i> Đặt câu hỏi mới
            </a>
        {% endif %}
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-warning">
            <h6><i class="fas fa-exclamation-triangle"></i> Lưu ý quan trọng</h6>
            <p class="mb-0">
                Các câu trả lời từ bác sĩ chỉ mang tính tham khảo và không thể thay thế cho việc khám, chẩn đoán trực tiếp. 
                Trong trường hợp cần thiết, vui lòng đặt lịch hẹn để được khám trực tiếp.
            </p>
        </div>
    </div>
</div>
{% endblock %}